# Cloudflare Workers + Pages dual deployment
name = "gracenook"
workers_dev = true
compatibility_date = "2025-11-22"
main = "src/worker.js"
pages_build_output_dir = "./dist"

# Build configuration (for Pages)
[build]
command = "pnpm build"
cwd = "./"

# Production environment: Worker + Pages + D1
[env.production]
name = "gracenook"

# D1 database binding (production only)
[[env.production.d1_databases]]
binding = "DB"
database_name = "gracenook_db"
database_id = "654c0b9e-fb63-4ef9-aaa9-39758baf87de"

# R2 bucket binding will be added once bucket is enabled in dashboard
# [[env.production.r2_buckets]]
# binding = "ASSETS"
# bucket_name = "gracenook-assets"

# Production environment variables
# JWT_SECRET is managed via `wrangler secret put` (not in config)
[env.production.vars]
API_URL = "https://gracenook.thebiggydg2019.workers.dev"

# Development environment: local dev Worker
[env.development]
name = "gracenook-dev"

[[env.development.d1_databases]]
binding = "DB"
database_name = "gracenook_db"
database_id = "654c0b9e-fb63-4ef9-aaa9-39758baf87de"

[env.development.vars]
API_URL = "http://localhost:8788"
